@page "/employees/create"
@rendermode InteractiveServer
@using Microsoft.EntityFrameworkCore
@using DataAccess
@using Microsoft.AspNetCore.Components.Forms
@inject IDbContextFactory<Cmpe232Web.Data.Cmpe232WebContext> DbFactory
@inject NavigationManager NavigationManager

<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h3>Sistem Personeli Tanımlama</h3>
        </div>
        <div class="card-body">
            <EditForm Model="newEmployee" OnValidSubmit="HandleValidSubmit">
                <DataAnnotationsValidator />

                <div class="mb-3">
                    <label class="form-label fw-bold">Personel Adı Soyadı:</label>
                    <InputText @bind-Value="newEmployee.Name" class="form-control" placeholder="Ad Soyad giriniz..." />
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">İşe Giriş Tarihi:</label>
                    <InputDate @bind-Value="newEmployee.HireDate" class="form-control" />
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">İletişim Bilgileri:</label>
                    <InputTextArea @bind-Value="newEmployee.ContactInfo" class="form-control" placeholder="Telefon, Adres veya Email..." />
                </div>

                <div class="mt-4">
                    <button type="submit" class="btn btn-success px-5">Personeli Kaydet</button>
                    <a href="/employees" class="btn btn-outline-secondary">Vazgeç</a>
                </div>
            </EditForm>
        </div>
    </div>
</div>

@code {
    // Direkt orijinal Employee modelini kullanıyoruz
    private Employee newEmployee = new() { HireDate = DateTime.Now };

    private async Task HandleValidSubmit()
    {
        using var context = DbFactory.CreateDbContext();

        // Sadece ana çalışan bilgilerini kaydediyoruz
        context.Set<Employee>().Add(newEmployee);
        await context.SaveChangesAsync();

        // Kayıttan sonra çalışan listesine yönlendiriyoruz
        NavigationManager.NavigateTo("/employees");
    }
}